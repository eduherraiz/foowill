{% extends "base.html" %}

{% block script %}
  <!--TODO: Download on static-->
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  <script>
    var trueValues = [604800, 1209600,1814400, /*weeks: 1 to 3*/
        2419200,4838400,7257600,9676800,12096000,14515200,16934400,19353600,21772800,24192000,26611200, /*months: 1 to 11*/
        29030400, 58060800, 87091200]; /*years: 1 to 3*/ /*17 items*/
    var values =  [0,3,6, /*scale in diferent proportion*/
                9,14,19,24,29,34,39,44,49,54,59,
                76,88,100];

    function findNearest(includeLeft, includeRight, value) {
        var nearest = null;
        var diff = null;
        for (var i = 0; i < values.length; i++) {
                if ((includeLeft && values[i] <= value) || (includeRight && values[i] >= value)) {
                        var newDiff = Math.abs(value - values[i]);
                        if (diff == null || newDiff < diff) {
                                nearest = values[i];
                                diff = newDiff;
                        }
                }
        }
        return nearest;
    }

    function getRealValue(value, values1, values2) {
        for (var i = 0; i < values1.length; i++) {
            if (values1[i] >= value) {
                return values2[i];
            }
        }
        return 0;
    }

    $(document).ready(function() {
        /*Slider activity_interval*/
        $(function() {
            var slider = $("#slider_ai").slider({
                min: 0,
                max: 100,
                value: getRealValue({% if form.instance.activity_interval %}{{form.instance.activity_interval}}{% else %}{{form.data.activity_interval}}{% endif %},trueValues,values),
                slide: function(event, ui) {
                        var includeLeft = event.keyCode != $.ui.keyCode.RIGHT;
                        var includeRight = event.keyCode != $.ui.keyCode.LEFT;
                        slider.slider('option', 'value', findNearest(includeLeft, includeRight, ui.value));
                        $("#id_activity_interval").val(getRealValue(slider.slider('value'),values,trueValues))
                        return false;
                }
            });

        });
    });

    select = $("#id_activity_interval").change(function () {
        $("#id_activity_interval option:selected").each(function () {
                val = $(this).val();
        });
        $("#slider_ai").slider('option','value',getRealValue(val,trueValues,values))
    })
  </script>
{% endblock %}

{% block heading %}Hello, {{ user.username }}{% endblock %}

{% block content %}

<div style="margin-bottom:30px;">
<h2>Configuración</h2>

<form action="/config/" method="post" class="form-horizontal well"> 

{% csrf_token %}
{{ form.non_field_errors }}
    
    <div class="control-group">
      <label class="control-label" for="activity_interval">Activity interval</label>
      <div class="controls">
        <p class="help-block">Tiempo que tiene que pasar sin actualizar tu cuenta en twitter para que empezemos a preocuparnos por tí.</p>
        <div id="slider_ai" style="width:400px;margin-top:10px;margin-bottom:10px;"></div>
	{{ form.activity_interval }}
	{{ form.activity_interval.errors }}
      </div>
    </div>

    <div class="control-group">
      <label class="control-label" for="email">Email</label>
      <div class="controls">
	{{ form.email }}
	<p class="help-block">Si no especificas dirección de email no podremos enviarte el email de verificación antes de darte por muerto y los post-tweets saldrán sin verificar si sigues vivo preguntándote por email.</p>
	{{ form.email.errors }}
      </div>
    </div>

    <div class="control-group">
      <label class="control-label" for="mail_interval">Mail interval</label>
      <div class="controls">
	{{ form.mail_interval }}
	<p class="help-block">Tiempo de espera después de enviar el email de verificación. Transcurrido este tiempo si no has actualizado twitter o contestado al email te daremos por muerto y publicaremos tus post-tweets.</p>
	{{ form.activity_interval.errors }}
      </div>
    </div>

    <div class="control-group">
      <label class="control-label" for="publish_interval">Publish interval</label>
      <div class="controls">
	{{ form.publish_interval }}
	<p class="help-block">Intervalo de publicación entre post-tweets. Con esto puedes escoger cada cuanto tiempo saldrán los post-tweets que guardarás.</p>
	{{ form.activity_interval.errors }}
      </div>
    </div>


    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Save changes</button>
      <button class="btn">Cancel</button>
    </div>

</form>

</div>

{% endblock %}
